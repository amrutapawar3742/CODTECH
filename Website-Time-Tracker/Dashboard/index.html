<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weekly Productivity Report</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="card">
    <h2>ðŸ“Š Weekly Productivity Report</h2>
    <canvas id="chart"></canvas>
</div>

<script>
// Session check
fetch("http://localhost:5000/session", {
    credentials: "include"
})
.then(res => {
    if (!res.ok) {
        window.location.href = "login.html";
    }
});

// Fetch weekly data
fetch("http://localhost:5000/weekly", {
    credentials: "include"
})
.then(res => {
    if (!res.ok) throw new Error("Not authorized or no data");
    return res.json();
})
.then(data => {
    if (data.length === 0) {
        console.log("No usage data yet");
        return;
    }

    const labels = data.map(d => d[0]);
    const values = data.map(d => d[1] / 3600000);

    // Color mapping
    const colorMap = {
        "Productive": "#4CAF50",     // Green
        "Unproductive": "#F44336",   // Red
        "Uncategorized": "#9E9E9E"   // Grey
    };

    const colors = labels.map(label => colorMap[label] || "#607D8B");

    new Chart(document.getElementById("chart"), {
        type: "pie",
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: colors
            }]
        },
        options: {
            plugins: {
                legend: {
                    position: "bottom"
                }
            }
        }
    });
})
.catch(err => console.log(err.message));
</script>

</body>
</html>
